// This file was auto-generated by ML.NET Model Builder.
using System;
using System.IO;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.ML.Data;
using Microsoft.ML.Trainers;
using Microsoft.ML;

namespace Diagnoser
{
    public partial class DiseaseFinder
    {
        public const string RetrainFilePath =  @"C:\Users\AHMEED\Music\Dataset\Disease Prediction\Training.csv";
        public const char RetrainSeparatorChar = ',';
        public const bool RetrainHasHeader =  true;
        public const bool RetrainAllowQuoting =  false;

         /// <summary>
        /// Train a new model with the provided dataset.
        /// </summary>
        /// <param name="outputModelPath">File path for saving the model. Should be similar to "C:\YourPath\ModelName.mlnet"</param>
        /// <param name="inputDataFilePath">Path to the data file for training.</param>
        /// <param name="separatorChar">Separator character for delimited training file.</param>
        /// <param name="hasHeader">Boolean if training file has a header.</param>
        public static void Train(string outputModelPath, string inputDataFilePath = RetrainFilePath, char separatorChar = RetrainSeparatorChar, bool hasHeader = RetrainHasHeader, bool allowQuoting = RetrainAllowQuoting)
        {
            var mlContext = new MLContext();

            var data = LoadIDataViewFromFile(mlContext, inputDataFilePath, separatorChar, hasHeader, allowQuoting);
            var model = RetrainModel(mlContext, data);
            SaveModel(mlContext, model, data, outputModelPath);
        }

        /// <summary>
        /// Load an IDataView from a file path.
        /// </summary>
        /// <param name="mlContext">The common context for all ML.NET operations.</param>
        /// <param name="inputDataFilePath">Path to the data file for training.</param>
        /// <param name="separatorChar">Separator character for delimited training file.</param>
        /// <param name="hasHeader">Boolean if training file has a header.</param>
        /// <returns>IDataView with loaded training data.</returns>
        public static IDataView LoadIDataViewFromFile(MLContext mlContext, string inputDataFilePath, char separatorChar, bool hasHeader, bool allowQuoting)
        {
            return mlContext.Data.LoadFromTextFile<ModelInput>(inputDataFilePath, separatorChar, hasHeader, allowQuoting: allowQuoting);
        }


        /// <summary>
        /// Save a model at the specified path.
        /// </summary>
        /// <param name="mlContext">The common context for all ML.NET operations.</param>
        /// <param name="model">Model to save.</param>
        /// <param name="data">IDataView used to train the model.</param>
        /// <param name="modelSavePath">File path for saving the model. Should be similar to "C:\YourPath\ModelName.mlnet.</param>
        public static void SaveModel(MLContext mlContext, ITransformer model, IDataView data, string modelSavePath)
        {
            // Pull the data schema from the IDataView used for training the model
            DataViewSchema dataViewSchema = data.Schema;

            using (var fs = File.Create(modelSavePath))
            {
                mlContext.Model.Save(model, dataViewSchema, fs);
            }
        }


        /// <summary>
        /// Retrain model using the pipeline generated as part of the training process.
        /// </summary>
        /// <param name="mlContext"></param>
        /// <param name="trainData"></param>
        /// <returns></returns>
        public static ITransformer RetrainModel(MLContext mlContext, IDataView trainData)
        {
            var pipeline = BuildPipeline(mlContext);
            var model = pipeline.Fit(trainData);

            return model;
        }

        /// <summary>
        /// build the pipeline that is used from model builder. Use this function to retrain model.
        /// </summary>
        /// <param name="mlContext"></param>
        /// <returns></returns>
        public static IEstimator<ITransformer> BuildPipeline(MLContext mlContext)
        {
            // Data process configuration with pipeline data transformations
            var pipeline = mlContext.Transforms.ReplaceMissingValues(new []{new InputOutputColumnPair(@"itching", @"itching"),new InputOutputColumnPair(@"skin_rash", @"skin_rash"),new InputOutputColumnPair(@"nodal_skin_eruptions", @"nodal_skin_eruptions"),new InputOutputColumnPair(@"continuous_sneezing", @"continuous_sneezing"),new InputOutputColumnPair(@"shivering", @"shivering"),new InputOutputColumnPair(@"chills", @"chills"),new InputOutputColumnPair(@"joint_pain", @"joint_pain"),new InputOutputColumnPair(@"stomach_pain", @"stomach_pain"),new InputOutputColumnPair(@"acidity", @"acidity"),new InputOutputColumnPair(@"ulcers_on_tongue", @"ulcers_on_tongue"),new InputOutputColumnPair(@"muscle_wasting", @"muscle_wasting"),new InputOutputColumnPair(@"vomiting", @"vomiting"),new InputOutputColumnPair(@"burning_micturition", @"burning_micturition"),new InputOutputColumnPair(@"spotting_ urination", @"spotting_ urination"),new InputOutputColumnPair(@"fatigue", @"fatigue"),new InputOutputColumnPair(@"weight_gain", @"weight_gain"),new InputOutputColumnPair(@"anxiety", @"anxiety"),new InputOutputColumnPair(@"cold_hands_and_feets", @"cold_hands_and_feets"),new InputOutputColumnPair(@"mood_swings", @"mood_swings"),new InputOutputColumnPair(@"weight_loss", @"weight_loss"),new InputOutputColumnPair(@"restlessness", @"restlessness"),new InputOutputColumnPair(@"lethargy", @"lethargy"),new InputOutputColumnPair(@"patches_in_throat", @"patches_in_throat"),new InputOutputColumnPair(@"irregular_sugar_level", @"irregular_sugar_level"),new InputOutputColumnPair(@"cough", @"cough"),new InputOutputColumnPair(@"high_fever", @"high_fever"),new InputOutputColumnPair(@"sunken_eyes", @"sunken_eyes"),new InputOutputColumnPair(@"breathlessness", @"breathlessness"),new InputOutputColumnPair(@"sweating", @"sweating"),new InputOutputColumnPair(@"dehydration", @"dehydration"),new InputOutputColumnPair(@"indigestion", @"indigestion"),new InputOutputColumnPair(@"headache", @"headache"),new InputOutputColumnPair(@"yellowish_skin", @"yellowish_skin"),new InputOutputColumnPair(@"dark_urine", @"dark_urine"),new InputOutputColumnPair(@"nausea", @"nausea"),new InputOutputColumnPair(@"loss_of_appetite", @"loss_of_appetite"),new InputOutputColumnPair(@"pain_behind_the_eyes", @"pain_behind_the_eyes"),new InputOutputColumnPair(@"back_pain", @"back_pain"),new InputOutputColumnPair(@"constipation", @"constipation"),new InputOutputColumnPair(@"abdominal_pain", @"abdominal_pain"),new InputOutputColumnPair(@"diarrhoea", @"diarrhoea"),new InputOutputColumnPair(@"mild_fever", @"mild_fever"),new InputOutputColumnPair(@"yellow_urine", @"yellow_urine"),new InputOutputColumnPair(@"yellowing_of_eyes", @"yellowing_of_eyes"),new InputOutputColumnPair(@"acute_liver_failure", @"acute_liver_failure"),new InputOutputColumnPair(@"fluid_overload", @"fluid_overload"),new InputOutputColumnPair(@"swelling_of_stomach", @"swelling_of_stomach"),new InputOutputColumnPair(@"swelled_lymph_nodes", @"swelled_lymph_nodes"),new InputOutputColumnPair(@"malaise", @"malaise"),new InputOutputColumnPair(@"blurred_and_distorted_vision", @"blurred_and_distorted_vision"),new InputOutputColumnPair(@"phlegm", @"phlegm"),new InputOutputColumnPair(@"throat_irritation", @"throat_irritation"),new InputOutputColumnPair(@"redness_of_eyes", @"redness_of_eyes"),new InputOutputColumnPair(@"sinus_pressure", @"sinus_pressure"),new InputOutputColumnPair(@"runny_nose", @"runny_nose"),new InputOutputColumnPair(@"congestion", @"congestion"),new InputOutputColumnPair(@"chest_pain", @"chest_pain"),new InputOutputColumnPair(@"weakness_in_limbs", @"weakness_in_limbs"),new InputOutputColumnPair(@"fast_heart_rate", @"fast_heart_rate"),new InputOutputColumnPair(@"pain_during_bowel_movements", @"pain_during_bowel_movements"),new InputOutputColumnPair(@"pain_in_anal_region", @"pain_in_anal_region"),new InputOutputColumnPair(@"bloody_stool", @"bloody_stool"),new InputOutputColumnPair(@"irritation_in_anus", @"irritation_in_anus"),new InputOutputColumnPair(@"neck_pain", @"neck_pain"),new InputOutputColumnPair(@"dizziness", @"dizziness"),new InputOutputColumnPair(@"cramps", @"cramps"),new InputOutputColumnPair(@"bruising", @"bruising"),new InputOutputColumnPair(@"obesity", @"obesity"),new InputOutputColumnPair(@"swollen_legs", @"swollen_legs"),new InputOutputColumnPair(@"swollen_blood_vessels", @"swollen_blood_vessels"),new InputOutputColumnPair(@"puffy_face_and_eyes", @"puffy_face_and_eyes"),new InputOutputColumnPair(@"enlarged_thyroid", @"enlarged_thyroid"),new InputOutputColumnPair(@"brittle_nails", @"brittle_nails"),new InputOutputColumnPair(@"swollen_extremeties", @"swollen_extremeties"),new InputOutputColumnPair(@"excessive_hunger", @"excessive_hunger"),new InputOutputColumnPair(@"extra_marital_contacts", @"extra_marital_contacts"),new InputOutputColumnPair(@"drying_and_tingling_lips", @"drying_and_tingling_lips"),new InputOutputColumnPair(@"slurred_speech", @"slurred_speech"),new InputOutputColumnPair(@"knee_pain", @"knee_pain"),new InputOutputColumnPair(@"hip_joint_pain", @"hip_joint_pain"),new InputOutputColumnPair(@"muscle_weakness", @"muscle_weakness"),new InputOutputColumnPair(@"stiff_neck", @"stiff_neck"),new InputOutputColumnPair(@"swelling_joints", @"swelling_joints"),new InputOutputColumnPair(@"movement_stiffness", @"movement_stiffness"),new InputOutputColumnPair(@"spinning_movements", @"spinning_movements"),new InputOutputColumnPair(@"loss_of_balance", @"loss_of_balance"),new InputOutputColumnPair(@"unsteadiness", @"unsteadiness"),new InputOutputColumnPair(@"weakness_of_one_body_side", @"weakness_of_one_body_side"),new InputOutputColumnPair(@"loss_of_smell", @"loss_of_smell"),new InputOutputColumnPair(@"bladder_discomfort", @"bladder_discomfort"),new InputOutputColumnPair(@"foul_smell_of urine", @"foul_smell_of urine"),new InputOutputColumnPair(@"continuous_feel_of_urine", @"continuous_feel_of_urine"),new InputOutputColumnPair(@"passage_of_gases", @"passage_of_gases"),new InputOutputColumnPair(@"internal_itching", @"internal_itching"),new InputOutputColumnPair(@"toxic_look_(typhos)", @"toxic_look_(typhos)"),new InputOutputColumnPair(@"depression", @"depression"),new InputOutputColumnPair(@"irritability", @"irritability"),new InputOutputColumnPair(@"muscle_pain", @"muscle_pain"),new InputOutputColumnPair(@"altered_sensorium", @"altered_sensorium"),new InputOutputColumnPair(@"red_spots_over_body", @"red_spots_over_body"),new InputOutputColumnPair(@"belly_pain", @"belly_pain"),new InputOutputColumnPair(@"abnormal_menstruation", @"abnormal_menstruation"),new InputOutputColumnPair(@"dischromic _patches", @"dischromic _patches"),new InputOutputColumnPair(@"watering_from_eyes", @"watering_from_eyes"),new InputOutputColumnPair(@"increased_appetite", @"increased_appetite"),new InputOutputColumnPair(@"polyuria", @"polyuria"),new InputOutputColumnPair(@"family_history", @"family_history"),new InputOutputColumnPair(@"mucoid_sputum", @"mucoid_sputum"),new InputOutputColumnPair(@"rusty_sputum", @"rusty_sputum"),new InputOutputColumnPair(@"lack_of_concentration", @"lack_of_concentration"),new InputOutputColumnPair(@"visual_disturbances", @"visual_disturbances"),new InputOutputColumnPair(@"receiving_blood_transfusion", @"receiving_blood_transfusion"),new InputOutputColumnPair(@"receiving_unsterile_injections", @"receiving_unsterile_injections"),new InputOutputColumnPair(@"coma", @"coma"),new InputOutputColumnPair(@"stomach_bleeding", @"stomach_bleeding"),new InputOutputColumnPair(@"distention_of_abdomen", @"distention_of_abdomen"),new InputOutputColumnPair(@"history_of_alcohol_consumption", @"history_of_alcohol_consumption"),new InputOutputColumnPair(@"fluid_overload2", @"fluid_overload2"),new InputOutputColumnPair(@"blood_in_sputum", @"blood_in_sputum"),new InputOutputColumnPair(@"prominent_veins_on_calf", @"prominent_veins_on_calf"),new InputOutputColumnPair(@"palpitations", @"palpitations"),new InputOutputColumnPair(@"painful_walking", @"painful_walking"),new InputOutputColumnPair(@"pus_filled_pimples", @"pus_filled_pimples"),new InputOutputColumnPair(@"blackheads", @"blackheads"),new InputOutputColumnPair(@"scurring", @"scurring"),new InputOutputColumnPair(@"skin_peeling", @"skin_peeling"),new InputOutputColumnPair(@"silver_like_dusting", @"silver_like_dusting"),new InputOutputColumnPair(@"small_dents_in_nails", @"small_dents_in_nails"),new InputOutputColumnPair(@"inflammatory_nails", @"inflammatory_nails"),new InputOutputColumnPair(@"blister", @"blister"),new InputOutputColumnPair(@"red_sore_around_nose", @"red_sore_around_nose"),new InputOutputColumnPair(@"yellow_crust_ooze", @"yellow_crust_ooze")})      
                                    .Append(mlContext.Transforms.Concatenate(@"Features", new []{@"itching",@"skin_rash",@"nodal_skin_eruptions",@"continuous_sneezing",@"shivering",@"chills",@"joint_pain",@"stomach_pain",@"acidity",@"ulcers_on_tongue",@"muscle_wasting",@"vomiting",@"burning_micturition",@"spotting_ urination",@"fatigue",@"weight_gain",@"anxiety",@"cold_hands_and_feets",@"mood_swings",@"weight_loss",@"restlessness",@"lethargy",@"patches_in_throat",@"irregular_sugar_level",@"cough",@"high_fever",@"sunken_eyes",@"breathlessness",@"sweating",@"dehydration",@"indigestion",@"headache",@"yellowish_skin",@"dark_urine",@"nausea",@"loss_of_appetite",@"pain_behind_the_eyes",@"back_pain",@"constipation",@"abdominal_pain",@"diarrhoea",@"mild_fever",@"yellow_urine",@"yellowing_of_eyes",@"acute_liver_failure",@"fluid_overload",@"swelling_of_stomach",@"swelled_lymph_nodes",@"malaise",@"blurred_and_distorted_vision",@"phlegm",@"throat_irritation",@"redness_of_eyes",@"sinus_pressure",@"runny_nose",@"congestion",@"chest_pain",@"weakness_in_limbs",@"fast_heart_rate",@"pain_during_bowel_movements",@"pain_in_anal_region",@"bloody_stool",@"irritation_in_anus",@"neck_pain",@"dizziness",@"cramps",@"bruising",@"obesity",@"swollen_legs",@"swollen_blood_vessels",@"puffy_face_and_eyes",@"enlarged_thyroid",@"brittle_nails",@"swollen_extremeties",@"excessive_hunger",@"extra_marital_contacts",@"drying_and_tingling_lips",@"slurred_speech",@"knee_pain",@"hip_joint_pain",@"muscle_weakness",@"stiff_neck",@"swelling_joints",@"movement_stiffness",@"spinning_movements",@"loss_of_balance",@"unsteadiness",@"weakness_of_one_body_side",@"loss_of_smell",@"bladder_discomfort",@"foul_smell_of urine",@"continuous_feel_of_urine",@"passage_of_gases",@"internal_itching",@"toxic_look_(typhos)",@"depression",@"irritability",@"muscle_pain",@"altered_sensorium",@"red_spots_over_body",@"belly_pain",@"abnormal_menstruation",@"dischromic _patches",@"watering_from_eyes",@"increased_appetite",@"polyuria",@"family_history",@"mucoid_sputum",@"rusty_sputum",@"lack_of_concentration",@"visual_disturbances",@"receiving_blood_transfusion",@"receiving_unsterile_injections",@"coma",@"stomach_bleeding",@"distention_of_abdomen",@"history_of_alcohol_consumption",@"fluid_overload2",@"blood_in_sputum",@"prominent_veins_on_calf",@"palpitations",@"painful_walking",@"pus_filled_pimples",@"blackheads",@"scurring",@"skin_peeling",@"silver_like_dusting",@"small_dents_in_nails",@"inflammatory_nails",@"blister",@"red_sore_around_nose",@"yellow_crust_ooze"}))      
                                    .Append(mlContext.Transforms.Conversion.MapValueToKey(outputColumnName:@"prognosis",inputColumnName:@"prognosis",addKeyValueAnnotationsAsText:false))      
                                    .Append(mlContext.MulticlassClassification.Trainers.OneVersusAll(binaryEstimator: mlContext.BinaryClassification.Trainers.LbfgsLogisticRegression(new LbfgsLogisticRegressionBinaryTrainer.Options(){L1Regularization=1F,L2Regularization=1F,LabelColumnName=@"prognosis",FeatureColumnName=@"Features"}), labelColumnName:@"prognosis"))      
                                    .Append(mlContext.Transforms.Conversion.MapKeyToValue(outputColumnName:@"PredictedLabel",inputColumnName:@"PredictedLabel"));

            return pipeline;
        }
    }
 }
